<!doctype html>
<html lang="pt">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no, minimal-ui"
    />

    <!-- PWA Meta Tags - Force iOS app behavior -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta name="apple-mobile-web-app-title" content="Leirisonda" />
    <meta name="application-name" content="Leirisonda" />
    <meta name="theme-color" content="#b30229" />
    <meta name="msapplication-TileColor" content="#b30229" />
    <meta name="msapplication-navbutton-color" content="#b30229" />
    <meta
      name="description"
      content="Sistema de gestão de obras e manutenção de piscinas da Leirisonda"
    />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-touch-fullscreen" content="yes" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-tap-highlight" content="no" />

    <!-- PWA Manifest -->
    <link
      rel="manifest"
      href="/manifest.json?v=2.0.1"
      crossorigin="use-credentials"
    />

    <!-- Apple Touch Icons com logo da Leirisonda -->
    <link
      rel="apple-touch-icon"
      sizes="180x180"
      href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTgwIiBoZWlnaHQ9IjE4MCIgdmlld0JveD0iMCAwIDE4MCAxODAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxODAiIGhlaWdodD0iMTgwIiByeD0iNDAiIGZpbGw9IiNiMzAyMjkiLz4KPHN2ZyB4PSI0NSIgeT0iNDUiIHdpZHRoPSI5MCIgaGVpZ2h0PSI5MCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgo8cGF0aCBkPSJNMyAxOGgxOHYtMkg5VjhIOXYzSDZ2M0gzVjE4WiIgZmlsbD0id2hpdGUiLz4KPHBhdGggZD0iTTkgOGgydjJIOVY4Wm02IDBoMnYySDE2Vjhab0g5IDhoMnYySDlWOFptNiAwaDJ2MkgxNlY4WiIgZmlsbD0iIzAwNzc4NCIvPgo8cGF0aCBkPSJNNiAxNGgzdjNINnYtM1ptNiAwaDN2M0gxMnYtM1ptNiAwaDN2M0gxOHYtM1oiIGZpbGw9IiMwMDc3ODQiIG9wYWNpdHk9IjAuOSIvPgo8cGF0aCBkPSJNMTIgNEwxNCA2aDJWNEgxMlptMCA0TDE0IDEwaDJWOEgxMlptMCA0TDE0IDE0aDJWMTJIMTJabTAgNEwxNCAxOGgyVjE2SDEyWiIgZmlsbD0iIzAwNzc4NCIgb3BhY2l0eT0iMC43Ii8+CjxwYXRoIGQ9Ik00IDIwaDEydjJINFYyMFptNCAtNGg4djJIOFYxNlptLTQgLTRoMTZ2Mkg0VjEyWm0wIC00aDE2djJINFY4WiIgZmlsbD0iIzAwNzc4NCIgb3BhY2l0eT0iMC42Ii8+CjxjaXJjbGUgY3g9IjE4IiBjeT0iNiIgcj0iMyIgZmlsbD0iIzAwNzc4NCIvPgo8cGF0aCBkPSJNMiAyaDIwdjJIMlYyWiIgZmlsbD0iIzAwNzc4NCIgb3BhY2l0eT0iMC40Ii8+Cjwvc3ZnPgo8L3N2Zz4="
    />
    <link
      rel="apple-touch-icon"
      sizes="152x152"
      href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTUyIiBoZWlnaHQ9IjE1MiIgdmlld0JveD0iMCAwIDE1MiAxNTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxNTIiIGhlaWdodD0iMTUyIiByeD0iMzQiIGZpbGw9IiNiMzAyMjkiLz4KPHN2ZyB4PSIzOCIgeT0iMzgiIHdpZHRoPSI3NiIgaGVpZ2h0PSI3NiIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgo8cGF0aCBkPSJNMyAxOGgxOHYtMkg5VjhIOXYzSDZ2M0gzVjE4WiIgZmlsbD0id2hpdGUiLz4KPHBhdGggZD0iTTkgOGgydjJIOVY4Wm02IDBoMnYySDE2Vjhab0g5IDhoMnYySDlWOFptNiAwaDJ2MkgxNlY4WiIgZmlsbD0iIzAwNzc4NCIvPgo8cGF0aCBkPSJNNiAxNGgzdjNINnYtM1ptNiAwaDN2M0gxMnYtM1ptNiAwaDN2M0gxOHYtM1oiIGZpbGw9IiMwMDc3ODQiIG9wYWNpdHk9IjAuOSIvPgo8cGF0aCBkPSJNMTIgNEwxNCA2aDJWNEgxMlptMCA0TDE0IDEwaDJWOEgxMlptMCA0TDE0IDE0aDJWMTJIMTJabTAgNEwxNCAxOGgyVjE2SDEyWiIgZmlsbD0iIzAwNzc4NCIgb3BhY2l0eT0iMC43Ii8+CjxwYXRoIGQ9Ik00IDIwaDEydjJINFYyMFptNCAtNGg4djJIOFYxNlptLTQgLTRoMTZ2Mkg0VjEyWiIgZmlsbD0iIzAwNzc4NCIgb3BhY2l0eT0iMC42Ci8+CjxjaXJjbGUgY3g9IjE4IiBjeT0iNiIgcj0iMyIgZmlsbD0iIzAwNzc4NCIvPgo8L3N2Zz4KPC9zdmc+"
    />
    <link
      rel="apple-touch-icon"
      sizes="120x120"
      href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTIwIiBoZWlnaHQ9IjEyMCIgdmlld0JveD0iMCAwIDEyMCAxMjAiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxMjAiIGhlaWdodD0iMTIwIiByeD0iMjciIGZpbGw9IiNiMzAyMjkiLz4KPHN2ZyB4PSIzMCIgeT0iMzAiIHdpZHRoPSI2MCIgaGVpZ2h0PSI2MCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgo8cGF0aCBkPSJNMyAxOGgxOHYtMkg5VjhIOXYzSDZ2M0gzVjE4WiIgZmlsbD0id2hpdGUiLz4KPHBhdGggZD0iTTkgOGgydjJIOVY4Wm02IDBoMnYySDE2Vjhab0g5IDhoMnYySDlWOFptNiAwaDJ2MkgxNlY4WiIgZmlsbD0iIzAwNzc4NCIvPgo8cGF0aCBkPSJNNiAxNGgzdjNINnYtM1ptNiAwaDN2M0gxMnYtM1ptNiAwaDN2M0gxOHYtM1oiIGZpbGw9IiMwMDc3ODQiIG9wYWNpdHk9IjAuOSIvPgo8cGF0aCBkPSJNMTIgNEwxNCA2aDJWNEgxMlptMCA0TDE0IDEwaDJWOEgxMlptMCA0TDE0IDE0aDJWMTJIMTJabTAgNEwxNCAxOGgyVjE2SDEyWiIgZmlsbD0iIzAwNzc4NCIgb3BhY2l0eT0iMC43Ci8+CjwvcMNnPgo8L3N2Zz4="
    />
    <link
      rel="apple-touch-icon"
      sizes="76x76"
      href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNzYiIGhlaWdodD0iNzYiIHZpZXdCb3g9IjAgMCA3NiA3NiIgZmlsbD0ibm9uZSIgeG1sbnM9Imh0dHA6Ly93d3cudzMub3JnLzIwMDAvc3ZnIj4KPHJlY3Qgd2lkdGg9Ijc2IiBoZWlnaHQ9Ijc2IiByeD0iMTciIGZpbGw9IiNiMzAyMjkiLz4KPHN2ZyB4PSIxOSIgeT0iMTkiIHdpZHRoPSIzOCIgaGVpZ2h0PSIzOCIgdmlld0JveD0iMCAwIDI0IDI0IiBmaWxsPSJub25lIiB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciPgo8cGF0aCBkPSJNMyAxOGgxOHYtMkg5VjhIOXYzSDZ2M0gzVjE4WiIgZmlsbD0id2hpdGUiLz4KPHBhdGggZD0iTTkgOGgydjJIOVY4Wm02IDBoMnYySDE2Vjhab0g5IDhoMnYySDlWOFptNiAwaDJ2MkgxNlY4WiIgZmlsbD0iIzAwNzc4NCIvPgo8cGF0aCBkPSJNNiAxNGgzdjNINnYtM1ptNiAwaDN2M0gxMnYtM1ptNiAwaDN2M0gxOHYtM1oiIGZpbGw9IiMwMDc3ODQiIG9wYWNpdHk9IjAuOCIvPgo8L3N2Zz4KPC9zdmc+"
    />

    <!-- Ícone PNG otimizado para iPhone com logo da Leirisonda -->
    <link rel="apple-touch-icon" href="/leirisonda-icon.svg?v=2.0.2" />

    <!-- Favicon e ícones adicionais com logo da Leirisonda -->
    <link rel="icon" href="/favicon.ico" />
    <link rel="icon" type="image/svg+xml" href="/favicon-leirisonda.svg" />
    <link rel="shortcut icon" href="/favicon-leirisonda.svg" />

    <!-- PWA Styles -->
    <link rel="stylesheet" href="/pwa-style.css" />

    <title>Leirisonda - Gestão de Obras</title>
  </head>

  <body>
    <div id="root"></div>

    <script type="module" src="/client/main.tsx"></script>

    <!-- PWA Service Worker -->
    <script>
      let deferredPrompt;

      // Debug PWA status
      console.log("PWA Debug - HTTPS:", location.protocol === "https:");
      console.log(
        "PWA Debug - Service Worker support:",
        "serviceWorker" in navigator,
      );
      console.log("PWA Debug - Standalone mode:", window.navigator.standalone);
      console.log(
        "PWA Debug - Display mode:",
        window.matchMedia("(display-mode: standalone)").matches,
      );

      // Force standalone behavior on iOS
      if (window.navigator.standalone === false) {
        console.log("⚠️ App opened in browser instead of standalone mode");
      } else if (window.navigator.standalone === true) {
        console.log("✅ App running in standalone mode");
      }

      if ("serviceWorker" in navigator) {
        window.addEventListener("load", function () {
          navigator.serviceWorker
            .register("/sw.js")
            .then(function (registration) {
              console.log("✅ Leirisonda SW registered:", registration.scope);
            })
            .catch(function (error) {
              console.log("❌ Leirisonda SW registration failed:", error);
            });
        });
      }

      // PWA Install prompt
      window.addEventListener("beforeinstallprompt", (e) => {
        console.log("🎉 PWA install prompt available");
        e.preventDefault();
        deferredPrompt = e;

        // Show install notification
        const notification = document.createElement("div");
        notification.style.cssText = `
          position: fixed; top: 20px; left: 50%; transform: translateX(-50%);
          background: #007784; color: white; padding: 12px 20px;
          border-radius: 8px; z-index: 10000; font-family: sans-serif;
          box-shadow: 0 4px 12px rgba(0,0,0,0.3);
        `;
        notification.innerHTML =
          '📱 Instalar Leirisonda como app? <button onclick="installPWA()" style="margin-left:10px;background:white;color:#007784;border:none;padding:4px 8px;border-radius:4px;cursor:pointer;">Instalar</button>';
        document.body.appendChild(notification);

        setTimeout(() => notification.remove(), 10000);
      });

      function installPWA() {
        if (deferredPrompt) {
          deferredPrompt.prompt();
          deferredPrompt.userChoice.then((choiceResult) => {
            console.log("User choice:", choiceResult.outcome);
            deferredPrompt = null;
          });
        }
      }

      window.installPWA = installPWA;
    </script>
  </body>
</html>
