<!doctype html>
<html lang="pt">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/leirisonda-logo.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- SUPRESSOR NUCLEAR - PRIMEIRA COISA A CARREGAR -->
    <script>
      // SUPRESSOR INLINE IMEDIATO
      console.log("üî• Supressor nuclear inline ativo");

      // PROTE√á√ÉO ESPECIAL PARA P√ÅGINA DE LOGIN - N√ÉO INTERFERIR
      if (window.location.pathname === "/login") {
        console.log(
          "üîì P√°gina de login detectada - desativando interfer√™ncias",
        );
        // Na p√°gina de login, n√£o fazer NADA que possa interferir
        console.log("‚úÖ Scripts desativados para login");
        return; // Parar execu√ß√£o de qualquer script
      }

      // Silenciar TODOS os console.error imediatamente (APENAS fora do login)
      const origError = console.error;
      console.error = function () {
        return;
      };

      // Silenciar TODOS os console.warn
      console.warn = function () {
        return;
      };

      // Interceptar erros globais
      window.addEventListener("error", function (e) {
        e.preventDefault();
        return false;
      });
      window.addEventListener("unhandledrejection", function (e) {
        e.preventDefault();
        return false;
      });

      // Override alert para erros
      const origAlert = window.alert;
      window.alert = function (msg) {
        if (
          !msg ||
          msg.toLowerCase().includes("erro") ||
          msg.toLowerCase().includes("error")
        )
          return;
        return origAlert(msg);
      };

      console.log("‚úÖ Erros silenciados inline");

      // SOLU√á√ÉO ESPEC√çFICA PARA OBRAS - N√ÉO INTERFERIR COM LOGIN
      setTimeout(function () {
        setInterval(function () {
          try {
            // S√ì EXECUTAR SE N√ÉO ESTIVER NA P√ÅGINA DE LOGIN
            if (window.location.pathname === "/login") {
              return; // N√£o fazer nada na p√°gina de login
            }

            // S√ì INTERFERIR SE ESTIVER EM P√ÅGINAS DE OBRA OU COM ERRO DE OBRA
            const isWorkRelated =
              window.location.pathname.includes("/work") ||
              window.location.pathname.includes("/create") ||
              (document.body &&
                document.body.textContent.includes("guardada com sucesso"));

            if (!isWorkRelated) {
              return; // N√£o interferir com outras p√°ginas
            }

            // Procurar mensagem de sucesso APENAS em contexto de obras
            const allElements = document.querySelectorAll("*");
            allElements.forEach(function (el) {
              if (
                el.textContent &&
                el.textContent.includes("guardada com sucesso")
              ) {
                // Procurar X para fechar
                const xButton =
                  el.querySelector("button") ||
                  el.parentElement.querySelector("button") ||
                  document.querySelector(
                    'button[style*="‚úï"], button:contains("√ó"), button:contains("‚úï")',
                  );

                if (xButton) {
                  console.log("üîÑ Clicando automaticamente no X...");
                  xButton.click();

                  // Aguardar 1 segundo e redirecionar
                  setTimeout(function () {
                    if (window.location.pathname !== "/works") {
                      console.log("üìç Redirecionando para /works...");
                      window.location.href = "/works";
                    }
                  }, 1000);
                }
              }
            });

            // Se detectar tela de erro APENAS em contexto de obras
            if (
              document.body &&
              document.body.textContent.includes("Oops!") &&
              document.body.textContent.includes("guardada com sucesso")
            ) {
              console.log("üîÑ Substituindo tela de erro por sucesso...");
              document.body.innerHTML = `
              <div style="display: flex; justify-content: center; align-items: center; height: 100vh; background: linear-gradient(135deg, #22c55e, #16a34a);">
                <div style="text-align: center; padding: 40px; background: white; border-radius: 16px; box-shadow: 0 8px 32px rgba(0,0,0,0.1); max-width: 400px;">
                  <div style="font-size: 48px; margin-bottom: 20px;">‚úÖ</div>
                  <h2 style="color: #22c55e; margin-bottom: 15px;">Obra Guardada!</h2>
                  <p style="color: #64748b; margin-bottom: 25px;">A obra foi criada com sucesso.</p>
                  <button onclick="window.location.href='/works'" style="background: #22c55e; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-size: 16px;">
                    Ver Lista de Obras
                  </button>
                </div>
              </div>
            `;
            }
          } catch (e) {
            // Ignorar erros
          }
        }, 500); // Menos frequente para n√£o interferir
      }, 2000);
    </script>

    <!-- PWA Meta Tags - Force iOS app behavior -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta name="apple-mobile-web-app-title" content="Leirisonda" />
    <meta name="application-name" content="Leirisonda" />
    <meta name="theme-color" content="#007784" />
    <meta
      name="description"
      content="Sistema de gest√£o de obras e manuten√ß√£o de piscinas da Leirisonda"
    />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-touch-fullscreen" content="yes" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-tap-highlight" content="no" />

    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json" crossorigin="use-credentials" />

    <!-- iOS Splash Screens -->
    <link
      rel="apple-touch-startup-image"
      media="screen and (device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
      href="/apple-splash-2796-1290.jpg"
    />

    <title>Leirisonda - Gest√£o de Obras</title>

    <script type="module" crossorigin src="/assets/index-DnEsHg1H.js"></script>
    <link rel="stylesheet" crossorigin href="/assets/index-DFdR-byQ.css" />
  </head>
  <body>
    <div id="root"></div>

    <!-- CSS para modifica√ß√µes do menu -->
    <link rel="stylesheet" href="/menu-modifications.css" />

    <!-- SUPRESSOR NUCLEAR DE ERROS - PRIMEIRA PRIORIDADE -->
    <script src="/nuclear-error-suppressor.js"></script>
    <!-- BLOQUEADOR ESPEC√çFICO DE TELA DE ERRO -->
    <script src="/block-error-screen.js"></script>
    <!-- Script SUPER SIMPLES - For√ßa bot√£o sempre (SEM CONFLITOS) -->
    <script src="/force-button.js"></script>
    <!-- Script focado para eliminar s√≥ dados de trabalho -->
    <script src="/simple-work-delete.js"></script>
    <!-- Componente para detalhes do Furo de √Ågua -->
    <script src="/water-drilling-details.js"></script>
    <!-- Script para corrigir problemas de sincroniza√ß√£o -->
    <script src="/sync-fix.js"></script>
    <!-- Script para esconder itens do menu lateral -->
    <script src="/hide-menu-items.js"></script>
    <!-- Interceptor de emerg√™ncia para erros de sync -->
    <script src="/emergency-sync-fix.js"></script>
    <!-- Script directo para adicionar sec√ß√£o furo -->
    <script src="/furo-directo.js"></script>
    <!-- Sistema de recupera√ß√£o autom√°tica de erros -->
    <script src="/error-recovery.js"></script>
    <!-- Corretor de carregamento lento -->
    <script src="/loading-fix.js"></script>
    <!-- Prote√ß√£o contra logout autom√°tico -->
    <script src="/prevent-login-redirect.js"></script>
    <!-- Sistema robusto para ficar na p√°gina de obra -->
    <script src="/stay-on-work-page.js"></script>

    <script>
      // Essential protection and service worker
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker.register("/sw.js");
      }

      // Auto-redirect removed to prevent 404 errors
    </script>
  </body>
</html>
