<!doctype html>
<html lang="pt">
  <head>
    <meta charset="UTF-8" />
    <link rel="icon" type="image/svg+xml" href="/leirisonda-logo.svg" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />

    <!-- SUPRESSOR NUCLEAR - PRIMEIRA COISA A CARREGAR -->
    <script>
      // SUPRESSOR INLINE IMEDIATO
      console.log("üî• Supressor nuclear inline ativo");

      // PROTE√á√ÉO ESPECIAL PARA P√ÅGINA DE LOGIN - N√ÉO INTERFERIR
      if (window.location.pathname === "/login") {
        console.log(
          "üîì P√°gina de login detectada - desativando interfer√™ncias",
        );
        // Na p√°gina de login, n√£o fazer NADA que possa interferir
        console.log("‚úÖ Scripts desativados para login");
        return; // Parar execu√ß√£o de qualquer script
      }

      // Silenciar TODOS os console.error imediatamente (APENAS fora do login)
      const origError = console.error;
      console.error = function () {
        return;
      };

      // Silenciar TODOS os console.warn
      console.warn = function () {
        return;
      };

      // Interceptar erros globais
      window.addEventListener("error", function (e) {
        e.preventDefault();
        return false;
      });
      window.addEventListener("unhandledrejection", function (e) {
        e.preventDefault();
        return false;
      });

      // Override alert para erros
      const origAlert = window.alert;
      window.alert = function (msg) {
        if (
          !msg ||
          msg.toLowerCase().includes("erro") ||
          msg.toLowerCase().includes("error")
        )
          return;
        return origAlert(msg);
      };

      console.log("‚úÖ Erros silenciados inline");

      // SOLU√á√ÉO ESPEC√çFICA PARA OBRAS - N√ÉO INTERFERIR COM LOGIN
      setTimeout(function () {
        setInterval(function () {
          try {
            // S√ì EXECUTAR SE N√ÉO ESTIVER NA P√ÅGINA DE LOGIN
            if (window.location.pathname === "/login") {
              return; // N√£o fazer nada na p√°gina de login
            }

            // S√ì INTERFERIR SE ESTIVER EM P√ÅGINAS DE OBRA OU COM ERRO DE OBRA
            const isWorkRelated =
              window.location.pathname.includes("/work") ||
              window.location.pathname.includes("/create") ||
              (document.body &&
                document.body.textContent.includes("guardada com sucesso"));

            if (!isWorkRelated) {
              return; // N√£o interferir com outras p√°ginas
            }

            // Procurar mensagem de sucesso APENAS em contexto de obras
            const allElements = document.querySelectorAll("*");
            allElements.forEach(function (el) {
              if (
                el.textContent &&
                el.textContent.includes("guardada com sucesso")
              ) {
                // Procurar X para fechar
                const xButton =
                  el.querySelector("button") ||
                  el.parentElement.querySelector("button") ||
                  document.querySelector(
                    'button[style*="‚úï"], button:contains("√ó"), button:contains("‚úï")',
                  );

                if (xButton) {
                  console.log("üîÑ Clicando automaticamente no X...");
                  xButton.click();

                  // Aguardar 1 segundo e redirecionar
                  setTimeout(function () {
                    if (window.location.pathname !== "/works") {
                      console.log("üìç Redirecionando para /works...");
                      window.location.href = "/works";
                    }
                  }, 1000);
                }
              }
            });

            // Se detectar tela de erro APENAS em contexto de obras
            if (
              document.body &&
              document.body.textContent.includes("Oops!") &&
              document.body.textContent.includes("guardada com sucesso")
            ) {
              console.log("üîÑ Substituindo tela de erro por sucesso...");
              document.body.innerHTML = `
              <div style="display: flex; justify-content: center; align-items: center; height: 100vh; background: linear-gradient(135deg, #22c55e, #16a34a);">
                <div style="text-align: center; padding: 40px; background: white; border-radius: 16px; box-shadow: 0 8px 32px rgba(0,0,0,0.1); max-width: 400px;">
                  <div style="font-size: 48px; margin-bottom: 20px;">‚úÖ</div>
                  <h2 style="color: #22c55e; margin-bottom: 15px;">Obra Guardada!</h2>
                  <p style="color: #64748b; margin-bottom: 25px;">A obra foi criada com sucesso.</p>
                  <button onclick="window.location.href='/works'" style="background: #22c55e; color: white; border: none; padding: 12px 24px; border-radius: 8px; cursor: pointer; font-size: 16px;">
                    Ver Lista de Obras
                  </button>
                </div>
              </div>
            `;
            }
          } catch (e) {
            // Ignorar erros
          }
        }, 500); // Menos frequente para n√£o interferir
      }, 2000);
    </script>

    <!-- PWA Meta Tags - Force iOS app behavior -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta name="apple-mobile-web-app-title" content="Leirisonda" />
    <meta name="application-name" content="Leirisonda" />
    <meta name="theme-color" content="#007784" />
    <meta
      name="description"
      content="Sistema de gest√£o de obras e manuten√ß√£o de piscinas da Leirisonda"
    />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-touch-fullscreen" content="yes" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-tap-highlight" content="no" />

    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json" crossorigin="use-credentials" />

    <!-- iOS Splash Screens -->
    <link
      rel="apple-touch-startup-image"
      media="screen and (device-width: 430px) and (device-height: 932px) and (-webkit-device-pixel-ratio: 3) and (orientation: portrait)"
      href="/apple-splash-2796-1290.jpg"
    />

    <title>Leirisonda - Gest√£o de Obras</title>

    <script type="module" crossorigin src="/assets/index-DnEsHg1H.js"></script>
    <link rel="stylesheet" crossorigin href="/assets/index-DFdR-byQ.css" />
  </head>
  <body>
    <div id="root"></div>

    <!-- CSS para modifica√ß√µes do menu -->
    <link rel="stylesheet" href="/menu-modifications.css" />

    <!-- CARREGAR SCRIPTS SELETIVAMENTE BASEADO NA P√ÅGINA -->
    <script>
      function carregarScripts() {
        const path = window.location.pathname;
        console.log("üìç P√°gina detectada:", path);

        // Scripts b√°sicos que carregam em todas as p√°ginas (exceto login)
        const scriptsBasicos = [];

        // Scripts para p√°ginas de obra (criar, editar, listar)
        const scriptsObras = [
          "/nuclear-error-suppressor.js",
          "/block-error-screen.js",
          "/prevent-login-redirect.js",
          "/stay-on-work-page.js",
          "/water-drilling-details.js",
          "/furo-directo.js",
        ];

        // Scripts para todas as p√°ginas autenticadas (depois do login)
        const scriptsAutenticados = [
          "/force-button.js",
          "/simple-work-delete.js",
          "/sync-fix.js",
          "/hide-menu-items.js",
          "/emergency-sync-fix.js",
          "/error-recovery.js",
          "/loading-fix.js",
        ];

        let scriptsParaCarregar = [];

        if (path === "/login") {
          console.log("üîì P√°gina de login - nenhum script carregado");
          return; // N√£o carregar nada no login
        }

        // Se √© p√°gina de obra, carregar scripts espec√≠ficos
        if (
          path.includes("/work") ||
          path.includes("/create") ||
          path === "/works"
        ) {
          console.log("üìã P√°gina de obras detectada");
          scriptsParaCarregar = [
            ...scriptsBasicos,
            ...scriptsObras,
            ...scriptsAutenticados,
          ];
        } else {
          // Outras p√°ginas autenticadas
          console.log("üîê P√°gina autenticada detectada");
          scriptsParaCarregar = [...scriptsBasicos, ...scriptsAutenticados];
        }

        // Verificar e carregar scripts com seguran√ßa
        function carregarScriptSeguro(src) {
          return new Promise(function (resolve, reject) {
            // Primeiro verificar se o script existe
            fetch(src, { method: "HEAD" })
              .then(function (response) {
                if (response.ok) {
                  // Script existe, carregar
                  const script = document.createElement("script");
                  script.src = src;
                  script.async = true;
                  script.onload = function () {
                    console.log("‚úÖ Script carregado:", src);
                    resolve();
                  };
                  script.onerror = function () {
                    console.log("‚ùå Erro ao carregar script:", src);
                    reject();
                  };
                  document.head.appendChild(script);
                } else {
                  console.log("‚ö†Ô∏è Script n√£o encontrado:", src);
                  resolve(); // Continuar mesmo se script n√£o existir
                }
              })
              .catch(function () {
                console.log("‚ö†Ô∏è N√£o foi poss√≠vel verificar script:", src);
                resolve(); // Continuar mesmo se verifica√ß√£o falhar
              });
          });
        }

        // Carregar scripts de forma ass√≠ncrona
        scriptsParaCarregar.forEach(carregarScriptSeguro);

        console.log(
          "üì¶ Total de scripts carregados:",
          scriptsParaCarregar.length,
        );
      }

      // Carregar scripts quando a p√°gina estiver pronta
      if (document.readyState === "loading") {
        document.addEventListener("DOMContentLoaded", carregarScripts);
      } else {
        carregarScripts();
      }

      // Recarregar scripts quando a URL mudar (SPAs)
      let currentUrl = window.location.href;
      setInterval(function () {
        if (window.location.href !== currentUrl) {
          currentUrl = window.location.href;
          console.log("üîÑ URL mudou, recarregando scripts...");
          setTimeout(carregarScripts, 500);
        }
      }, 1000);
    </script>

    <script>
      // Essential protection and service worker
      if ("serviceWorker" in navigator) {
        navigator.serviceWorker.register("/sw.js");
      }

      // Auto-redirect removed to prevent 404 errors
    </script>
  </body>
</html>
