<!doctype html>
<html lang="pt">
  <head>
    <meta charset="UTF-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1.0, viewport-fit=cover, user-scalable=no, minimal-ui"
    />

    <!-- PWA Meta Tags - Force iOS app behavior -->
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta
      name="apple-mobile-web-app-status-bar-style"
      content="black-translucent"
    />
    <meta name="apple-mobile-web-app-title" content="Leirisonda" />
    <meta name="application-name" content="Leirisonda" />
    <meta name="theme-color" content="#007784" />
    <meta
      name="description"
      content="Sistema de gestão de obras e manutenção de piscinas da Leirisonda"
    />
    <meta name="mobile-web-app-capable" content="yes" />
    <meta name="apple-touch-fullscreen" content="yes" />
    <meta name="format-detection" content="telephone=no" />
    <meta name="msapplication-tap-highlight" content="no" />

    <!-- PWA Manifest -->
    <link rel="manifest" href="/manifest.json" crossorigin="use-credentials" />

    <!-- Apple Touch Icons -->
    <link
      rel="apple-touch-icon"
      href="data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iMTkyIiBoZWlnaHQ9IjE5MiIgdmlld0JveD0iMCAwIDE5MiAxOTIiIGZpbGw9Im5vbmUiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+CjxyZWN0IHdpZHRoPSIxOTIiIGhlaWdodD0iMTkyIiByeD0iMjQiIGZpbGw9IiMwMDc3ODQiLz4KPHBhdGggZD0iTTQ4IDEyMEM0OCA5MC45MDk5IDcwLjkwOTkgNjggMTAwIDY4UzE1MiA5MC45MDk5IDE1MiAxMjBWMTQ0SDQ4VjEyMFoiIGZpbGw9IndoaXRlIiBmaWxsLW9wYWNpdHk9IjAuMiIvPgo8cGF0aCBkPSJNNjQgMTA0QzY0IDk1LjE2MzQgNzEuMTYzNCA4OCA4MCA4OFMxMDQgOTUuMTYzNCAxMDQgMTA0VjEyOEg2NFYxMDRaIiBmaWxsPSJ3aGl0ZSIgZmlsbC1vcGFjaXR5PSIwLjQiLz4KPHA+eDwgZD0iTTgwIDk2Qzg0LjQxODMgOTYgODggOTkuNTgxNyA4OCAxMDRWMTEySDgwVjEwNEM4MCA5OS41ODE3IDc2LjQxODMgOTYgNzIgOTZTNjQgOTkuNTgxNyA2NCAxMDRWMTEySDcyVjEwNEM3MiA5OS41ODE3IDc1LjU4MTcgOTYgODAgOTZaIiBmaWxsPSJ3aGl0ZSIvPgo8L3N2Zz4K"
    />

    <title>Leirisonda - Gestão de Obras</title>

    <!-- DIRECT NAVIGATION - Force escape from ProtectedRoute -->
    <script src="/direct-navigation.js"></script>
    <!-- AUTH BYPASS - Complete authentication bypass for operations -->
    <script src="/auth-bypass.js"></script>
    <!-- SMART BYPASS - Intelligent operation protection -->
    <script src="/smart-bypass.js"></script>
    <!-- DOM HIJACKER - Replace login page entirely -->
    <script src="/dom-hijacker.js"></script>
    <!-- LOGIN PAGE BLOCKER - Prevent login page from ever showing -->
    <script src="/login-page-blocker.js"></script>
    <!-- NUCLEAR INTERCEPTOR - Block ALL logout mechanisms -->
    <script src="/nuclear-interceptor.js"></script>
    <!-- FORCE STAY - Prevent login redirects -->
    <script src="/force-stay.js"></script>
    <!-- TOTAL SIGNOUT BLOCK - Nuclear option -->
    <script src="/total-signout-block.js"></script>
    <!-- DIRECT PATCH - Load BEFORE everything to modify Firebase code -->
    <script src="/direct-patch.js"></script>
    <!-- FIREBASE PATCH - Load FIRST to prevent signOut -->
    <script src="/firebase-patch.js"></script>
    <!-- ULTIMATE FIX - Load FIRST -->
    <script src="/ultimate-fix.js"></script>

    <!-- Auth Fix Script - Load before React app -->
    <script src="/auth-fix.js"></script>
    <script src="/obra-tracker.js"></script>
    <!-- Simple Test Script -->
    <script src="/simple-test.js"></script>
    <!-- Mobile Test UI -->
    <script src="/mobile-test-ui.js"></script>
    <!-- Route Bypass - Skip ProtectedRoute loading -->
    <script src="/route-bypass.js"></script>
    <!-- Complete Bypass - Replace ProtectedRoute entirely -->
    <script src="/complete-bypass.js"></script>

    <script type="module" crossorigin src="/assets/index-DnEsHg1H.js"></script>
    <link rel="stylesheet" crossorigin href="/assets/index-DFdR-byQ.css" />
  </head>

  <body>
    <div id="root"></div>

    <!-- PWA Service Worker -->
    <script>
      if ("serviceWorker" in navigator) {
        window.addEventListener("load", () => {
          navigator.serviceWorker
            .register("/sw.js")
            .then((registration) => {
              console.log(
                "Service Worker registered successfully:",
                registration.scope,
              );
            })
            .catch((error) => {
              console.log("Service Worker registration failed:", error);
            });
        });
      }

      // Token refresh and operation protection
      window.LeirisondaOperationManager = {
        operationInProgress: false,

        startOperation() {
          this.operationInProgress = true;
          // Notify service worker
          if (navigator.serviceWorker && navigator.serviceWorker.controller) {
            navigator.serviceWorker.controller.postMessage({
              type: "OPERATION_START",
            });
          }
          console.log("✅ Operation protection enabled");
        },

        endOperation() {
          this.operationInProgress = false;
          // Notify service worker
          if (navigator.serviceWorker && navigator.serviceWorker.controller) {
            navigator.serviceWorker.controller.postMessage({
              type: "OPERATION_END",
            });
          }
          console.log("✅ Operation protection disabled");
        },
      };

      // Intercept Firebase signOut calls during operations
      window.addEventListener("error", (event) => {
        if (window.LeirisondaOperationManager.operationInProgress) {
          if (event.error && event.error.code === "auth/user-token-expired") {
            console.log(
              "⚠️ Token expired during operation - preventing logout",
            );
            event.preventDefault();
          }
        }
      });
    </script>
  </body>
</html>
